<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>LAYOUT-DESIGNER</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
        
        <!-- Google Fonts einbinden -->
        <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital@0;1&display=swap" rel="stylesheet">

        <style>
            body { font-family: Arial, sans-serif; text-align: center; }
            #canvas-container {
                 position: relative;
                 display: inline-block;
                 border: 2px solid black;
                 margin-top: 10px;
            }

            #toolbar {
                position: relative;
                display: none;
                background: #f0f0f0;
                padding: 8px;
                border-radius: 5px;
                box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
                z-index: 10;
                display: flex;
                align-items: center;
                gap: 10px;
                margin-top: 10px;
                justify-content: center;
            }
            button, select, input { margin: 3px; padding: 5px; }
        </style>
    </head>
    
<body>

    <h2>LAYOUT-DESIGNER</h2>
    <div><label for="layoutSelector">W√§hle Deinen Style:</label><select id="layoutSelector" onchange="changeLayout(this.value)"></select><button id="exportBtn">PNG Export</button></div>
    
    <div id="apiVariableEditor">
        <h3>Variablen bearbeiten</h3>
        <label>Name 1: <input type="text" id="varName1" value="SOPHIE"></label>
        <label>Name 2: <input type="text" id="varName2" value="MAX"></label>
        <label>Datum: <input type="text" id="varWeddingDate" value="12. M√§rz 2025"></label>
        <button onclick="updateVariables()">Variablen speichern</button>
    </div>
    <div><button onclick="saveLayoutToAPI(false)">Speichern</button>
        <button onclick="saveLayoutToAPI(true)">Speichern & Freigeben</button>
    </div>
    
    <div id="canvas-container">
        <canvas id="canvas" width="800" height="400"></canvas>
    </div>
    <div><button id="textModeBtn">Textfeld hinzuf√ºgen</button></div>
    
    <div id="toolbar">
        <select id="fontFamily" onchange="updateText('fontFamily', this.value)">
            <option value="Raleway">Raleway</option>
            <option value="Baskerville">Baskerville</option>
            <option value="Arial">Arial</option>
            <option value="Verdana">Verdana</option>
            <option value="Courier New">Courier</option>
            <option value="Georgia">Georgia</option>
        </select>
        <input type="number" id="fontSize" value="30" min="10" max="100" onchange="updateText('fontSize', this.value)">
        <button onclick="toggleBold()">B</button>
        <button onclick="toggleItalic()">I</button>
        <button onclick="setAlign('left')">‚¨Ö</button>
        <button onclick="setAlign('center')">üî≥</button>
        <button onclick="setAlign('right')">‚û°</button>
        <input type="color" id="textColor" onchange="updateText('fill', this.value)">
        <button onclick="deleteText()">L√∂schen</button>
    </div>
  
    <script>
        const layouts = [
    { id: 1, name: "Style 1 - 15x10 - 2 Fotos", format: "15x10", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style1.png", textGroups: [
            { groupId: "names", 
                groupX: 300,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 84,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 450, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 30, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 30, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 30, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 300,  // Zentrum der Gruppe
                groupY: 103,  // Vertikale Position
                spacing: 15,
                maxWidth: 200, // Maximale Breite der Gruppe
                texts: [
                    { text: "‚Ä¢ weddingDate ‚Ä¢", size: 18, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 300,  // Zentrum der Gruppe
                groupY: 156,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 2, name: "Style 2 - 15x10 - 2 Fotos", format: "15x10", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style2.png", textGroups: [
            { groupId: "names", 
                groupX: 300,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 282,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 500, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 18, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 18, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 18, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "‚Ä¢  weddingDate", size: 18, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 300,  // Zentrum der Gruppe
                groupY: 301,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 3, name: "Style 3 - 15x10 - 2 Fotos", format: "15x10", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style3.png", textGroups: [
            { groupId: "names1", 
                groupX: 155,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 127,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 250, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 27, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            { groupId: "and", 
                groupX: 155,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 133,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 250, // Maximale Breite der Gruppe
                texts: [
                    { text: "und", size: 18, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 200, fill: "#000000"}
                ]
            },
            { groupId: "names2", 
                groupX: 155,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 166,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 250, // Maximale Breite der Gruppe
                originY: "top",
                texts: [
                    { text: "name2", size: 27, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            { groupId: "date", 
                groupX: 155,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 215,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 12, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 100, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 155,  // Zentrum der Gruppe
                groupY: 370,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },
    
    { id: 4, name: "Style 4 - 15x10 - 3 Fotos", format: "15x10", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style4.png", textGroups: [
    { groupId: "names", 
                groupX: 166,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 72,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 230, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 20, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 20, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 20, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 166,  // Zentrum der Gruppe
                groupY: 96,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 12, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 166,  // Zentrum der Gruppe
                groupY: 161,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 5, name: "Style 5 - 10x15 - 6 Fotos", format: "10x15", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style5.png", textGroups: [
    { groupId: "names", 
                groupX: 200,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 463,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 350, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 28, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 28, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 28, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 200,  // Zentrum der Gruppe
                groupY: 490,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 14, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 100, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 200,  // Zentrum der Gruppe
                groupY: 560,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 6, name: "Style 6 - 15x10 - 3 Fotos", format: "15x10", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style6.png", textGroups: [
    { groupId: "names", 
                groupX: 300,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 88,   // Vertikale Position der Gruppe
                spacing: 15,  // Abstand zwischen den Texten
                maxWidth: 500, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 30, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 30, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 30, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 300,  // Zentrum der Gruppe
                groupY: 107,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 14, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 300,  // Zentrum der Gruppe
                groupY: 383,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 7, name: "Style 7 - 15x10 - 3 Fotos", format: "15x10", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style7.png", textGroups: [
    { groupId: "names", 
                groupX: 120,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 186,   // Vertikale Position der Gruppe
                spacing: 10,  // Abstand zwischen den Texten
                maxWidth: 200, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 16, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 16, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 16, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 120,  // Zentrum der Gruppe
                groupY: 146,  // Vertikale Position
                spacing: 5,
                maxWidth: 200, // Maximale Breite der Gruppe
                texts: [
                    { text: "Erinnerungen f√ºr die Ewigkeit", size: 8, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"} ,
                    { text: "|", size: 8, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"} ,
                    { text: "weddingDate", size: 8, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 120,  // Zentrum der Gruppe
                groupY: 206,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 8, name: "Style 8 - 15x10 - 2 Fotos", format: "15x10", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style8.png", textGroups: [
    { groupId: "names", 
                groupX: 300,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 59,   // Vertikale Position der Gruppe
                spacing: 10,  // Abstand zwischen den Texten
                maxWidth: 285, // Maximale Breite der Gruppe
                originY: "center",
                texts: [
                    { text: "name1", size: 30, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 30, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 30, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date_ad",
                groupX: 300,  // Zentrum der Gruppe
                groupY: 367,  // Vertikale Position
                spacing: 5,
                maxWidth: 200, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 10, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"},
                    { text: "| EINFACH KNIPS¬Æ", size: 10, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 9, name: "Style 9 - 15x5 - 2 Fotos", format: "15x5", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style9.png", textGroups: [
            {   groupId: "names1", 
                groupX: 68,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 77,   // Vertikale Position der Gruppe
                spacing: 5,  // Abstand zwischen den Texten
                maxWidth: 100, // Maximale Breite der Gruppe
                texts: [
                    { text: "name1", size: 21, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"},
                ]
            },
            {   groupId: "names2", 
                groupX: 68,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 124,   // Vertikale Position der Gruppe
                spacing: 5,  // Abstand zwischen den Texten
                maxWidth: 100, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "&", size: 21, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 21, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 68,  // Zentrum der Gruppe
                groupY: 46,  // Vertikale Position
                spacing: 5,
                maxWidth: 100, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 8, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 68,  // Zentrum der Gruppe
                groupY: 145,  // Vertikale Position
                spacing: 15,
                maxWidth: 100, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 7, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 10, name: "Style 10 - 15x5 - 2 Fotos", format: "15x5", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style10.png", textGroups: [
            {   groupId: "names1", 
                groupX: 507,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 50,   // Vertikale Position der Gruppe
                spacing: 5,  // Abstand zwischen den Texten
                maxWidth: 110, // Maximale Breite der Gruppe
                texts: [
                    { text: "name1", size: 20, fontFamily: "Raleway", charSpacing: 200, fill: "#000000"},
                ]
            },
            {   groupId: "names2", 
                groupX: 507,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 73,   // Vertikale Position der Gruppe
                spacing: 5,  // Abstand zwischen den Texten
                maxWidth: 110, // Maximale Breite der Gruppe
                texts: [
                    { text: "&", size: 20, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 100, fill: "#000000"},
                    { text: "name2", size: 20, fontFamily: "Raleway", charSpacing: 200, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 507,  // Zentrum der Gruppe
                groupY: 103,  // Vertikale Position
                spacing: 5,
                maxWidth: 100, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 8, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 507,  // Zentrum der Gruppe
                groupY: 159,  // Vertikale Position
                spacing: 15,
                maxWidth: 100, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 11, name: "Style 11 - 15x5 - 2 Fotos", format: "15x5", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style11.png", textGroups: [
            { 
                groupId: "names", 
                groupX: 300,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 160,   // Vertikale Position der Gruppe
                spacing: 10,  // Abstand zwischen den Texten
                maxWidth: 285, // Maximale Breite der Gruppe
                originY: "center",
                texts: [
                    { text: "‚Ä¢ name1", size: 15, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 15, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "name2 ‚Ä¢", size: 15, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date_ad",
                groupX: 300,  // Zentrum der Gruppe
                groupY: 175,  // Vertikale Position
                spacing: 5,
                maxWidth: 200, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 10, fontFamily: "Raleway", charSpacing: 80, fill: "#000000"},
                    { text: "| EINFACH KNIPS¬Æ", size: 10, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 12, name: "Style 12 - 15x5 - 3 Fotos", format: "15x5", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style12.png", textGroups: [
            { 
                groupId: "names", 
                groupX: 300,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 18,   // Vertikale Position der Gruppe
                spacing: 10,  // Abstand zwischen den Texten
                maxWidth: 400, // Maximale Breite der Gruppe
                originY: "center",
                texts: [
                    { text: "‚Ä¢ name1", size: 14, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 14, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 300, fill: "#000000"},
                    { text: "name2 ‚Ä¢", size: 14, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date_ad",
                groupX: 300,  // Zentrum der Gruppe
                groupY: 175,  // Vertikale Position
                spacing: 5,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "Ab jetzt - f√ºr immer |", size: 9, fontFamily: "Raleway", charSpacing: 80, fill: "#000000"} ,
                    { text: "weddingDate", size: 9, fontFamily: "Raleway", charSpacing: 80, fill: "#000000"},
                    { text: "| EINFACH KNIPS¬Æ", size: 9, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 13, name: "Style 13 - 5x15 - 4 Fotos", format: "5x15", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style13.png", textGroups: [
            { 
                groupId: "names", 
                groupX: 100,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 533,   // Vertikale Position der Gruppe
                spacing: 10,  // Abstand zwischen den Texten
                maxWidth: 160, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 15, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "&", size: 15, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 15, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 100,  // Zentrum der Gruppe
                groupY: 547,  // Vertikale Position
                spacing: 5,
                maxWidth: 200, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 12, fontFamily: "Raleway", charSpacing: 80, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 100,  // Zentrum der Gruppe
                groupY: 577,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 14, name: "Style 14 - 5x15 - 3 Fotos", format: "5x15", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style14.png", textGroups: [
    {   groupId: "names1", 
                groupX: 100,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 63,   // Vertikale Position der Gruppe
                spacing: 5,  // Abstand zwischen den Texten
                maxWidth: 160, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 24, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                ]
            },
            {   groupId: "names2", 
                groupX: 100,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 61,   // Vertikale Position der Gruppe
                spacing: 5,  // Abstand zwischen den Texten
                maxWidth: 160, // Maximale Breite der Gruppe
                texts: [
                    { text: "&", size: 24, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 100, fill: "#000000"},
                    { text: "name2", size: 24, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 100,  // Zentrum der Gruppe
                groupY: 107,  // Vertikale Position
                spacing: 5,
                maxWidth: 200, // Maximale Breite der Gruppe
                texts: [
                    { text: "weddingDate", size: 10, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 100,  // Zentrum der Gruppe
                groupY: 542,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 15, name: "Style 15 - 5x15 - 3 Fotos", format: "5x15", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style15.png", textGroups: [
    {   groupId: "names1", 
                groupX: 100,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 205,   // Vertikale Position der Gruppe
                spacing: 5,  // Abstand zwischen den Texten
                maxWidth: 160, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 24, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                ]
            },
            {   groupId: "names2", 
                groupX: 100,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 201,   // Vertikale Position der Gruppe
                spacing: 5,  // Abstand zwischen den Texten
                maxWidth: 160, // Maximale Breite der Gruppe
                texts: [
                    { text: "&", size: 24, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 100, fill: "#000000"},
                    { text: "name2", size: 24, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 100,  // Zentrum der Gruppe
                groupY: 237,  // Vertikale Position
                spacing: 5,
                maxWidth: 200, // Maximale Breite der Gruppe
                texts: [
                    { text: "‚Ä¢ weddingDate ‚Ä¢", size: 10, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 100,  // Zentrum der Gruppe
                groupY: 572,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },

    { id: 16, name: "Style 16 - 5x15 - 4 Fotos", format: "5x15", background: "https://app.layoutdesigner.einfach-knips.de/public_html/assets/style16.png", textGroups: [
            { 
                groupId: "names", 
                groupX: 100,  // Mittelpunkt der Gruppe auf X-Achse
                groupY: 30,   // Vertikale Position der Gruppe
                spacing: 10,  // Abstand zwischen den Texten
                maxWidth: 170, // Maximale Breite der Gruppe
                originY: "bottom",
                texts: [
                    { text: "name1", size: 14, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "+", size: 14, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"},
                    { text: "name2", size: 14, fontFamily: "Raleway", charSpacing: 300, fill: "#000000"}
                ]
            },
            {
                groupId: "date",
                groupX: 100,  // Zentrum der Gruppe
                groupY: 558,  // Vertikale Position
                spacing: 5,
                maxWidth: 80, // Maximale Breite der Gruppe
                originY: "center",
                texts: [
                    { text: "weddingDate", size: 10, fontFamily: "Baskerville", fontWeight: "italic", charSpacing: 80, fill: "#000000"}
                ]
            },
            {
                groupId: "ad",
                groupX: 100,  // Zentrum der Gruppe
                groupY: 574,  // Vertikale Position
                spacing: 15,
                maxWidth: 500, // Maximale Breite der Gruppe
                texts: [
                    { text: "EINFACH KNIPS¬Æ", size: 8, fontFamily: "Raleway", charSpacing: 100, fill: "#000000"}
                ]
            }
        ]
    },
 ]
 
 // üîπ Globale API-Variablen
 const apiVariables = {
            name1: "SOPHIE",
            name2: "MAX",
            weddingDate: "12. M√§rz 2025",
};

// ‚úÖ Funktion zum Laden der Daten aus der API per Deeplink
async function loadLayoutFromAPI(layoutId) {
    try {
        const response = await fetch(`https://backendlayoutdesigner-production.up.railway.app/layouts/${layoutId}`);
        if (!response.ok) throw new Error("Fehler beim Laden des Layouts");

        const layoutData = await response.json();
        console.log("üì• Geladenes Layout:", layoutData);

        if (layoutData.layoutData) {
            console.log(`üü¢ Lade gespeichertes Layout ${layoutId}`);
            canvas.loadFromJSON(layoutData.layoutData, () => {
                canvas.renderAll();
                
                if (layoutData.isFinal) {
                    lockEditor("Dieses Layout wurde bereits finalisiert. √Ñnderungen sind nur nach vorheriger R√ºcksprache m√∂glich.");
                }
            });
        } else {
            console.log(`üîµ Kein gespeichertes Layout gefunden, lade Standard-Layout`);
            changeLayout(1); // Standard-Layout 1
        }
    } catch (error) {
        console.error("‚ùå Fehler beim Laden des Layouts:", error);
        lockEditor("Fehler: Layout konnte nicht geladen werden.");
    }
}

document.addEventListener("DOMContentLoaded", () => {
    populateDropdown();

    // ‚úÖ Pr√ºfen, ob eine g√ºltige Layout-ID vorhanden ist
    const layoutId = checkLayoutID();
    if (layoutId) {
        console.log("üîó Lade Layout aus API f√ºr ID:", layoutId);
        loadLayoutFromAPI(layoutId);
    }
});

        function populateDropdown() {
            const dropdown = document.getElementById("layoutSelector");
            layouts.forEach(layout => {
                const option = document.createElement("option");
                option.value = layout.id;
                option.textContent = `${layout.id}: ${layout.name} (${layout.format})`;
                dropdown.appendChild(option);
            });
        }

        function addTextGroups(layout) {
    layout.textGroups.forEach(group => {
        let textObjects = [];

        // Falls kein originY definiert ist, nutze "top" als Standard
        const originY = group.originY || "top"; 

        // 1Ô∏è‚É£ Erstelle die Texte & speichere die exakten Breiten
        group.texts.forEach((t) => {
            const textObj = new fabric.IText(t.text, {
                fontSize: t.size,
                fontFamily: t.fontFamily || "Arial",
                fontWeight: t.fontWeight || "normal",
                charSpacing: t.charSpacing || 0,
                fill: t.fill || "#000000",
                originX: "left",
                originY: originY,
                selectable: true,
                editable: true
            });

            canvas.add(textObj);
            textObjects.push(textObj);
        });

        // 2Ô∏è‚É£ Berechne `totalWidth` der Gruppe
        let totalWidth = textObjects.reduce((sum, obj, index) => sum + obj.width + (index < textObjects.length - 1 ? group.spacing : 0), 0);

        // 3Ô∏è‚É£ Falls die Gruppe zu breit ist, verkleinere die Schriftgr√∂√üe
        if (totalWidth > group.maxWidth) {
            let scaleFactor = group.maxWidth / totalWidth;
            textObjects.forEach(obj => {
                obj.set("fontSize", obj.fontSize * scaleFactor);
            });

            canvas.renderAll();

            // Nach dem Skalieren erneut `totalWidth` berechnen
            totalWidth = textObjects.reduce((sum, obj, index) => sum + obj.width + (index < textObjects.length - 1 ? group.spacing : 0), 0);
        }

        // 4Ô∏è‚É£ Berechne den Startpunkt f√ºr die exakte Zentrierung
        let startX = group.groupX - (totalWidth / 2);

        // 5Ô∏è‚É£ Positioniere die Texte mit korrekt berechnetem Abstand
        textObjects.forEach((obj, index) => {
            obj.set({ left: startX, top: group.groupY });
            obj.setCoords();
            startX += obj.width + (index < textObjects.length - 1 ? group.spacing : 0);
        });

        canvas.renderAll();
    });
}

function changeLayout(layoutId) {
    const layout = layouts.find(l => l.id == layoutId);
    if (!layout) return;

    // Falls es eine tempor√§r gespeicherte Version gibt, lade diese
    const savedCanvasData = sessionStorage.getItem(`layout_${layoutId}`);

    // Canvas leeren
    canvas.clear();

    if (savedCanvasData) {
        console.log(`üü° Lade tempor√§r gespeicherte Version von Layout ${layoutId}`);
        canvas.loadFromJSON(savedCanvasData, () => {
            canvas.renderAll();
        });
    } else {
        console.log(`üîµ Lade Standard-Layout ${layoutId}`);
        fabric.Image.fromURL(layout.background, function(img) {
            img.set({
                left: 0,
                top: 0,
                scaleX: canvas.width / img.width,
                scaleY: canvas.height / img.height,
                originX: "left",
                originY: "top"
            });
            canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
        }, { crossOrigin: "anonymous" });

        // Text hinzuf√ºgen
        addTextGroups(layout);

        // Standard-Namen und Datum setzen
        setTimeout(() => {
            updateCanvasText();
        }, 100);
    }
}


        const canvas = new fabric.Canvas("canvas");

        canvas.selection = true; // Mehrfachauswahl durch Auswahlbox aktivieren
        
        let textModeActive = false; // Standard: Kein neues Textfeld erstellen

// Event-Listener f√ºr den T-Button
document.getElementById("textModeBtn").addEventListener("click", function() {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;

    addText(centerX, centerY); // Erstellt sofort ein Textfeld in der Mitte des Canvas
});


// Falls au√üerhalb eines Textfelds geklickt wird, deaktivieren
canvas.on("mouse:down", function(event) {
    if (!event.target) {
        if (textModeActive) {
            addText(event.pointer.x, event.pointer.y);
            textModeActive = false; // Nach dem Hinzuf√ºgen deaktivieren
            document.getElementById("textModeBtn").classList.remove("active");
        } else {
            canvas.discardActiveObject();
            canvas.renderAll();
            document.getElementById("toolbar").style.display = "none"; // Toolbar ausblenden
        }
    }
});


      canvas.on("object:moving", function(event) {
    const activeObjects = canvas.getActiveObjects();
    if (activeObjects.length > 1) {
        activeObjects.forEach(obj => {
            obj.setCoords(); // Position aktualisieren
        });
    }
});

function updateToolbar() {
    const activeObject = canvas.getActiveObject();
    if (!activeObject || !activeObject.isType("i-text")) {
        document.getElementById("toolbar").style.display = "none";
        return;
    }

    // üîπ Setze die aktuellen Werte aus dem ausgew√§hlten Textfeld
    document.getElementById("fontFamily").value = activeObject.fontFamily || "Arial";
    document.getElementById("fontSize").value = activeObject.fontSize || 30;
    document.getElementById("textColor").value = activeObject.fill || "#000000";

    // üîπ Aktualisiere den Status von Bold & Italic Buttons
    document.querySelector("button[onclick='toggleBold()']").classList.toggle("active", activeObject.fontWeight === "bold");
    document.querySelector("button[onclick='toggleItalic()']").classList.toggle("active", activeObject.fontStyle === "italic");

    // üîπ Setze die richtige Textausrichtung als "active"
    document.querySelectorAll("#toolbar button").forEach(btn => btn.classList.remove("active"));
    if (activeObject.originX) {
        document.querySelector(`button[onclick="setAlign('${activeObject.originX}')"]`)?.classList.add("active");
    }

    // üîπ Toolbar einblenden
    document.getElementById("toolbar").style.display = "flex";
}

function addText(x, y) {
    const text = new fabric.IText("Hier Text eingeben", {
        left: x,
        top: y,
        fontFamily: "Arial",
        fontSize: 20,
        fill: "#000000",
        fontWeight: "normal",
        fontStyle: "normal",
        textAlign: "left",
        selectable: true,
        editable: true
    });

    canvas.add(text);
    canvas.setActiveObject(text);
    text.enterEditing();

    setTimeout(() => {
        if (text.hiddenTextarea) {
            text.hiddenTextarea.focus();
        }
    }, 100); 

    showToolbar();
}



        function showToolbar() {
            document.getElementById("toolbar").style.display = "flex";
        }

        function updateText(property, value) {
          const activeObjects = canvas.getActiveObjects();
          if (activeObjects.length > 0) {
             activeObjects.forEach(obj => {
            if (obj.isType("i-text")) {
                obj.set(property, value);
            }
        });
        canvas.renderAll();
        updateToolbar(); // Toolbar-Werte nach √Ñnderung aktualisieren
    }
}


        function toggleBold() {
            const activeObject = canvas.getActiveObject();
            if (activeObject && activeObject.isType("i-text")) {
                activeObject.set("fontWeight", activeObject.fontWeight === "bold" ? "normal" : "bold");
                canvas.renderAll();
            }
        }

        function toggleItalic() {
            const activeObject = canvas.getActiveObject();
            if (activeObject && activeObject.isType("i-text")) {
                activeObject.set("fontStyle", activeObject.fontStyle === "italic" ? "normal" : "italic");
                canvas.renderAll();
            }
        }

        function setAlign(align) {
            const activeObjects = canvas.getActiveObjects();
             if (activeObjects.length > 0) {
                  activeObjects.forEach(obj => {
                  if (obj.isType("i-text")) {
                obj.set({ originX: align });
            }
        });
        
        canvas.renderAll();
        updateToolbar(); // üîπ Toolbar nach √Ñnderung aktualisieren
    }
}


        function deleteText() {
    const activeObjects = canvas.getActiveObjects();
    if (activeObjects.length > 0) {
        activeObjects.forEach(obj => {
            if (obj.isType("i-text")) {
                canvas.remove(obj);
            }
        });
        canvas.discardActiveObject();
        canvas.renderAll();
        document.getElementById("toolbar").style.display = "none";
    }
}

        canvas.on("object:moving", function(event) {
            let obj = event.target;
            if (obj && obj.isType("i-text")) {
            console.log(`Text: "${obj.text}" | X: ${Math.round(obj.left)}, Y: ${Math.round(obj.top)}`);
            }
        });

        document.getElementById("exportBtn").addEventListener("click", function() {
    exportCanvasAsPNG();
});


function exportCanvasAsPNG() {
    // Speichere die aktuelle Canvas-Gr√∂√üe
    const originalWidth = canvas.width;
    const originalHeight = canvas.height;
    const currentLayout = layouts.find(l => l.id == document.getElementById("layoutSelector").value);

    if (!currentLayout) return;

    let exportWidth, exportHeight;
    if (currentLayout.format === "15x10") {
        exportWidth = 1844;
        exportHeight = 1240;
    } else if (currentLayout.format === "10x15") {
        exportWidth = 1240;
        exportHeight = 1844;
    } else if (currentLayout.format === "15x5") {
        exportWidth = 1844;
        exportHeight = 620;
    } else if (currentLayout.format === "5x15") {
        exportWidth = 620;
        exportHeight = 1844;
    }

    const scaleFactorX = exportWidth / originalWidth;
    const scaleFactorY = exportHeight / originalHeight;

    // 1Ô∏è‚É£ Canvas auf Exportgr√∂√üe setzen
    canvas.setDimensions({ width: exportWidth, height: exportHeight });

    // 2Ô∏è‚É£ Hintergrundbild in Originalgr√∂√üe laden
    fabric.Image.fromURL(currentLayout.background, function(img) {
        img.set({
            left: 0,
            top: 0,
            scaleX: exportWidth / img.width,
            scaleY: exportHeight / img.height,
            originX: "left",
            originY: "top"
        });

        canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));

        // 3Ô∏è‚É£ Alle Objekte auf Exportgr√∂√üe skalieren
        canvas.getObjects().forEach(obj => {
            obj.set({
                left: obj.left * scaleFactorX,
                top: obj.top * scaleFactorY,
                scaleX: obj.scaleX * scaleFactorX,
                scaleY: obj.scaleY * scaleFactorY
            });
            obj.setCoords();
        });

        canvas.renderAll();

        // 4Ô∏è‚É£ PNG exportieren
        setTimeout(() => {
            const dataURL = canvas.toDataURL({ format: "png", quality: 1 });

            const link = document.createElement("a");
            link.href = dataURL;
            link.download = `layout.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // 5Ô∏è‚É£ Canvas wieder auf Vorschaugr√∂√üe zur√ºcksetzen
            canvas.setDimensions({ width: originalWidth, height: originalHeight });

            // 6Ô∏è‚É£ Hintergrundbild f√ºr Vorschau zur√ºckladen
            fabric.Image.fromURL(currentLayout.background, function(img) {
                img.set({
                    left: 0,
                    top: 0,
                    scaleX: originalWidth / img.width,
                    scaleY: originalHeight / img.height,
                    originX: "left",
                    originY: "top"
                });

                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
            });

            // 7Ô∏è‚É£ Alle Objekte auf Vorschaugr√∂√üe zur√ºckskalieren
            canvas.getObjects().forEach(obj => {
                obj.set({
                    left: obj.left / scaleFactorX,
                    top: obj.top / scaleFactorY,
                    scaleX: obj.scaleX / scaleFactorX,
                    scaleY: obj.scaleY / scaleFactorY
                });
                obj.setCoords();
            });

            canvas.renderAll();
        }, 200); // Kleine Verz√∂gerung f√ºr Rendering
    }, { crossOrigin: "anonymous" });
}

// üîπ Entferne den doppelten Event Listener f√ºr den Export-Button
document.getElementById("exportBtn").removeEventListener("click", exportCanvasAsPNG);

function updateToolbar() {
    const activeObjects = canvas.getActiveObjects();
    document.getElementById("toolbar").style.display = activeObjects.length > 0 ? "flex" : "none";
}


canvas.on("object:modified", function() {
    updateToolbar();
});

document.addEventListener("keydown", function(event) {
    const activeObject = canvas.getActiveObject();
    if (!activeObject) return;

    // Falls das Textfeld gerade bearbeitet wird
    if (activeObject.isEditing) {
        if (event.key === "Enter") {
            activeObject.exitEditing();
            canvas.discardActiveObject();
            canvas.renderAll();
            document.getElementById("toolbar").style.display = "none";
            event.preventDefault();
        }
        return; // üîπ Falls bearbeitet wird, keine weiteren Aktionen ausf√ºhren
    }

    // Falls kein Bearbeitungsmodus aktiv ist
    if (event.key === "Delete" || event.key === "Backspace") {
        deleteText();
        event.preventDefault();
    }

    // Pfeiltasten: Nur wenn nicht im Edit-Modus
    if (["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"].includes(event.key)) {
        let step = event.shiftKey ? 10 : 1;
        
        if (event.key === "ArrowLeft") activeObject.set("left", activeObject.left - step);
        if (event.key === "ArrowRight") activeObject.set("left", activeObject.left + step);
        if (event.key === "ArrowUp") activeObject.set("top", activeObject.top - step);
        if (event.key === "ArrowDown") activeObject.set("top", activeObject.top + step);

        activeObject.setCoords();
        canvas.renderAll();
        
        // üîπ NEU: Zeigt die aktuelle Position in der Konsole an
        console.log(`Text: "${activeObject.text}" | X: ${Math.round(activeObject.left)}, Y: ${Math.round(activeObject.top)}`);

        event.preventDefault();
    }
});



canvas.on("mouse:dblclick", function(event) {
    if (event.target && event.target.isType("i-text")) {
        event.target.enterEditing();
        setTimeout(() => {
            event.target.hiddenTextarea?.focus();
        }, 50);
    }
});

canvas.on("mouse:down", function(event) {
    const activeObject = canvas.getActiveObject();
    if (activeObject && activeObject.isEditing && !event.target) {
        activeObject.exitEditing();
        canvas.discardActiveObject();
        canvas.renderAll();
        document.getElementById("toolbar").style.display = "none";
    }
});

canvas.on("selection:created", updateToolbar);
canvas.on("selection:updated", updateToolbar);
canvas.on("object:modified", updateToolbar);

function updateVariables() {
    // 1Ô∏è‚É£ Neue Werte aus den Eingabefeldern √ºbernehmen
    apiVariables.name1 = document.getElementById("varName1").value;
    apiVariables.name2 = document.getElementById("varName2").value;
    apiVariables.weddingDate = document.getElementById("varWeddingDate").value;

    console.log("üîπ Aktualisierte Variablen:", apiVariables);

    // 2Ô∏è‚É£ JSON-Daten mit neuen Werten √ºberschreiben
    layouts.forEach(layout => {
        layout.textGroups.forEach(group => {
            group.texts.forEach(t => {
                t.text = t.text
                    .replace(/name1/g, apiVariables.name1)
                    .replace(/name2/g, apiVariables.name2)
                    .replace(/weddingDate/g, apiVariables.weddingDate);
            });
        });
    });

    // 3Ô∏è‚É£ Text direkt im Canvas aktualisieren, ohne das Layout neu zu laden
    updateCanvasText();
}

function updateCanvasText() {
    console.log("üîÑ Update Canvas Text gestartet...");

    canvas.getObjects().forEach(obj => {
        if (obj.isType("i-text")) {
            console.log("üéØ Vorher:", obj.text);
            
            if (obj.text.includes("name1")) {
                obj.set("text", apiVariables.name1);
                console.log("‚úÖ Aktualisiert: name1 ‚Üí", apiVariables.name1);
            }
            if (obj.text.includes("name2")) {
                obj.set("text", apiVariables.name2);
                console.log("‚úÖ Aktualisiert: name2 ‚Üí", apiVariables.name2);
            }
            if (obj.text.includes("weddingDate")) {
                obj.set("text", apiVariables.weddingDate);
                console.log("‚úÖ Aktualisiert: weddingDate ‚Üí", apiVariables.weddingDate);
            }
        }
    });

    canvas.renderAll();
    console.log("‚úÖ Canvas wurde neu gezeichnet.");
}

async function saveLayoutToAPI(isFinal = false) {
    const layoutId = document.getElementById("layoutSelector").value;
    const canvasData = JSON.stringify(canvas.toJSON());

    const payload = {
        layoutId: layoutId,
        layoutData: canvasData,
        isFinal: isFinal
    };

    try {
        const response = await fetch(`https://backendlayoutdesigner-production.up.railway.app/layouts/${layoutId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error("Fehler beim Speichern");

        console.log(`‚úÖ Layout ${layoutId} erfolgreich gespeichert (isFinal: ${isFinal})`);
        alert("Layout gespeichert!");
    } catch (error) {
        console.error("‚ùå Fehler beim Speichern:", error);
    }
}

function lockEditor(message) {
    // Sperrt die Bearbeitung des Canvas
    canvas.selection = false;
    canvas.forEachObject(obj => obj.selectable = false);
    
    // Zeigt eine Nachricht an
    const lockMessage = document.createElement("div");
    lockMessage.id = "lockMessage";
    lockMessage.innerHTML = `<p>${message}</p>`;
    lockMessage.style.position = "absolute";
    lockMessage.style.top = "50%";
    lockMessage.style.left = "50%";
    lockMessage.style.transform = "translate(-50%, -50%)";
    lockMessage.style.background = "rgba(255, 0, 0, 0.8)";
    lockMessage.style.color = "white";
    lockMessage.style.padding = "15px";
    lockMessage.style.borderRadius = "8px";
    lockMessage.style.fontSize = "18px";
    lockMessage.style.zIndex = "1000";
    document.body.appendChild(lockMessage);
}

function checkLayoutID() {
    const urlParams = new URLSearchParams(window.location.search);
    const layoutId = urlParams.get("id");

    if (!layoutId) {
        console.warn("‚ùå Keine g√ºltige Layout-ID gefunden!");
        lockEditor("Fehler: Keine g√ºltige Layout-ID gefunden. Bitte verwenden Sie einen g√ºltigen Link.");
        return null;
    }

    return layoutId;
}

function saveTemporaryLayout() {
    const layoutId = document.getElementById("layoutSelector").value;
    const canvasData = JSON.stringify(canvas.toJSON());

    sessionStorage.setItem(`layout_${layoutId}`, canvasData);
    console.log(`üíæ Layout ${layoutId} tempor√§r gespeichert`);
}

// Jedes Mal, wenn das Canvas ver√§ndert wird, speichere die √Ñnderung tempor√§r
canvas.on("object:modified", saveTemporaryLayout);
canvas.on("object:added", saveTemporaryLayout);

    </script>
</body>
</html>
